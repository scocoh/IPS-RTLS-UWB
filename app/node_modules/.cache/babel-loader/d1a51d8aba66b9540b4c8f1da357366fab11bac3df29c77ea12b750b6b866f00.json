{"ast":null,"code":"var _jsxFileName = \"/home/parcoadmin/parco_fastapi/app/src/components/MapBuildOut.js\",\n  _s = $RefreshSig$();\n// # VERSION 250316 /home/parcoadmin/parco_fastapi/app/src/components/MapBuildOut.js 0P.10B.01\n// #  \n// # ParcoRTLS Middletier Services, ParcoRTLS DLL, ParcoDatabases, ParcoMessaging, and other code\n// # Copyright (C) 1999 - 2025 Affiliated Commercial Services Inc.\n// # Invented by Scott Cohen & Bertrand Dugal.\n// # Coded by Jesse Chunn O.B.M.'24 and Michael Farnsworth and Others\n// # Published at GitHub https://github.com/scocoh/IPS-RTLS-UWB\n// #\n// # Licensed under AGPL-3.0: https://www.gnu.org/licenses/agpl-3.0.en.html\n\nimport React, { useEffect, useRef } from \"react\";\nimport L from \"leaflet\";\nimport \"leaflet/dist/leaflet.css\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst MapBuildOut = ({\n  zoneId,\n  onDrawComplete,\n  devices,\n  useLeaflet\n}) => {\n  _s();\n  const canvasRef = useRef(null);\n  const mapRef = useRef(null);\n  const mapInstance = useRef(null);\n  useEffect(() => {\n    if (!zoneId) return;\n    if (useLeaflet && !mapInstance.current) {\n      fetch(`/zonebuilder/get_map_data/${zoneId}`).then(res => res.json()).then(data => {\n        mapInstance.current = L.map(mapRef.current, {\n          crs: L.CRS.Simple\n        }).fitBounds(data.bounds);\n        L.imageOverlay(data.imageUrl, data.bounds).addTo(mapInstance.current);\n        mapInstance.current.on(\"click\", e => {\n          const {\n            lat,\n            lng\n          } = e.latlng;\n          onDrawComplete({\n            n_x: lng,\n            n_y: lat\n          });\n          L.marker([lat, lng]).addTo(mapInstance.current);\n        });\n        devices.forEach(d => {\n          if (d.n_moe_x && d.n_moe_y) {\n            L.marker([d.n_moe_y, d.n_moe_x]).addTo(mapInstance.current).bindPopup(`${d.x_id_dev}: ${d.x_nm_dev}`);\n          }\n        });\n      });\n    } else if (!useLeaflet) {\n      const canvas = canvasRef.current;\n      const ctx = canvas.getContext(\"2d\");\n      fetch(`/zonebuilder/get_map_data/${zoneId}`).then(res => res.json()).then(data => {\n        const img = new Image();\n        img.src = data.imageUrl;\n        img.onload = () => {\n          canvas.width = img.width;\n          canvas.height = img.height;\n          ctx.drawImage(img, 0, 0);\n          devices.forEach(d => {\n            if (d.n_moe_x && d.n_moe_y) {\n              ctx.fillStyle = \"red\";\n              ctx.beginPath();\n              ctx.arc(d.n_moe_x, d.n_moe_y, 5, 0, 2 * Math.PI);\n              ctx.fill();\n              ctx.fillStyle = \"black\";\n              ctx.fillText(`${d.x_id_dev}: ${d.x_nm_dev}`, d.n_moe_x + 10, d.n_moe_y);\n            }\n          });\n        };\n        canvas.onclick = e => {\n          const rect = canvas.getBoundingClientRect();\n          const x = e.clientX - rect.left;\n          const y = e.clientY - rect.top;\n          onDrawComplete({\n            n_x: x,\n            n_y: y\n          });\n          ctx.fillStyle = \"red\";\n          ctx.beginPath();\n          ctx.arc(x, y, 5, 0, 2 * Math.PI);\n          ctx.fill();\n        };\n      });\n    }\n    return () => {\n      if (mapInstance.current) {\n        mapInstance.current.remove();\n        mapInstance.current = null;\n      }\n    };\n  }, [zoneId, onDrawComplete, devices, useLeaflet]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: useLeaflet ? /*#__PURE__*/_jsxDEV(\"div\", {\n      ref: mapRef,\n      style: {\n        height: \"400px\",\n        width: \"600px\",\n        border: \"2px solid black\"\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 17\n    }, this) : /*#__PURE__*/_jsxDEV(\"canvas\", {\n      ref: canvasRef,\n      style: {\n        border: \"2px solid black\"\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 17\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 87,\n    columnNumber: 9\n  }, this);\n};\n_s(MapBuildOut, \"sVQpp2lcZQ2xW2ixDHwS2LtiGHY=\");\n_c = MapBuildOut;\nexport default MapBuildOut;\nvar _c;\n$RefreshReg$(_c, \"MapBuildOut\");","map":{"version":3,"names":["React","useEffect","useRef","L","jsxDEV","_jsxDEV","MapBuildOut","zoneId","onDrawComplete","devices","useLeaflet","_s","canvasRef","mapRef","mapInstance","current","fetch","then","res","json","data","map","crs","CRS","Simple","fitBounds","bounds","imageOverlay","imageUrl","addTo","on","e","lat","lng","latlng","n_x","n_y","marker","forEach","d","n_moe_x","n_moe_y","bindPopup","x_id_dev","x_nm_dev","canvas","ctx","getContext","img","Image","src","onload","width","height","drawImage","fillStyle","beginPath","arc","Math","PI","fill","fillText","onclick","rect","getBoundingClientRect","x","clientX","left","y","clientY","top","remove","children","ref","style","border","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["/home/parcoadmin/parco_fastapi/app/src/components/MapBuildOut.js"],"sourcesContent":["// # VERSION 250316 /home/parcoadmin/parco_fastapi/app/src/components/MapBuildOut.js 0P.10B.01\n// #  \n// # ParcoRTLS Middletier Services, ParcoRTLS DLL, ParcoDatabases, ParcoMessaging, and other code\n// # Copyright (C) 1999 - 2025 Affiliated Commercial Services Inc.\n// # Invented by Scott Cohen & Bertrand Dugal.\n// # Coded by Jesse Chunn O.B.M.'24 and Michael Farnsworth and Others\n// # Published at GitHub https://github.com/scocoh/IPS-RTLS-UWB\n// #\n// # Licensed under AGPL-3.0: https://www.gnu.org/licenses/agpl-3.0.en.html\n\nimport React, { useEffect, useRef } from \"react\";\nimport L from \"leaflet\";\nimport \"leaflet/dist/leaflet.css\";\n\nconst MapBuildOut = ({ zoneId, onDrawComplete, devices, useLeaflet }) => {\n    const canvasRef = useRef(null);\n    const mapRef = useRef(null);\n    const mapInstance = useRef(null);\n\n    useEffect(() => {\n        if (!zoneId) return;\n\n        if (useLeaflet && !mapInstance.current) {\n            fetch(`/zonebuilder/get_map_data/${zoneId}`)\n                .then(res => res.json())\n                .then(data => {\n                    mapInstance.current = L.map(mapRef.current, { crs: L.CRS.Simple }).fitBounds(data.bounds);\n                    L.imageOverlay(data.imageUrl, data.bounds).addTo(mapInstance.current);\n\n                    mapInstance.current.on(\"click\", (e) => {\n                        const { lat, lng } = e.latlng;\n                        onDrawComplete({ n_x: lng, n_y: lat });\n                        L.marker([lat, lng]).addTo(mapInstance.current);\n                    });\n\n                    devices.forEach(d => {\n                        if (d.n_moe_x && d.n_moe_y) {\n                            L.marker([d.n_moe_y, d.n_moe_x]).addTo(mapInstance.current).bindPopup(`${d.x_id_dev}: ${d.x_nm_dev}`);\n                        }\n                    });\n                });\n        } else if (!useLeaflet) {\n            const canvas = canvasRef.current;\n            const ctx = canvas.getContext(\"2d\");\n            fetch(`/zonebuilder/get_map_data/${zoneId}`)\n                .then(res => res.json())\n                .then(data => {\n                    const img = new Image();\n                    img.src = data.imageUrl;\n                    img.onload = () => {\n                        canvas.width = img.width;\n                        canvas.height = img.height;\n                        ctx.drawImage(img, 0, 0);\n                        devices.forEach(d => {\n                            if (d.n_moe_x && d.n_moe_y) {\n                                ctx.fillStyle = \"red\";\n                                ctx.beginPath();\n                                ctx.arc(d.n_moe_x, d.n_moe_y, 5, 0, 2 * Math.PI);\n                                ctx.fill();\n                                ctx.fillStyle = \"black\";\n                                ctx.fillText(`${d.x_id_dev}: ${d.x_nm_dev}`, d.n_moe_x + 10, d.n_moe_y);\n                            }\n                        });\n                    };\n                    canvas.onclick = (e) => {\n                        const rect = canvas.getBoundingClientRect();\n                        const x = e.clientX - rect.left;\n                        const y = e.clientY - rect.top;\n                        onDrawComplete({ n_x: x, n_y: y });\n                        ctx.fillStyle = \"red\";\n                        ctx.beginPath();\n                        ctx.arc(x, y, 5, 0, 2 * Math.PI);\n                        ctx.fill();\n                    };\n                });\n        }\n\n        return () => {\n            if (mapInstance.current) {\n                mapInstance.current.remove();\n                mapInstance.current = null;\n            }\n        };\n    }, [zoneId, onDrawComplete, devices, useLeaflet]);\n\n    return (\n        <div>\n            {useLeaflet ? (\n                <div ref={mapRef} style={{ height: \"400px\", width: \"600px\", border: \"2px solid black\" }} />\n            ) : (\n                <canvas ref={canvasRef} style={{ border: \"2px solid black\" }} />\n            )}\n        </div>\n    );\n};\n\nexport default MapBuildOut;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}